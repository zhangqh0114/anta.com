<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="安踏,安踏官方网站,安踏官方旗舰店,安踏官网专卖店,安踏官方商城,安踏官方网站专卖店,安踏专卖店,安踏官网,男鞋,女鞋,运动鞋,篮球鞋,跑鞋,anta"><meta name="description" content="安踏官方旗舰店，安踏官方商城,提供ANTA男鞋,女鞋,运动鞋,休闲鞋,篮球鞋,跑鞋,综训鞋；提供最好的商品,最优质的服务,7天无条件退换货,正品保证!"><link rel="stylesheet" href="../css/common.css"><link rel="stylesheet" href="../font/iconfont.css"><link rel="stylesheet" href="../css/header.css"><link rel="stylesheet" href="../css/cart.css"><title>购物车</title></head><body><!-- 头部样式 --><header id="backtop"><div class="headTop"><a href="login.html">登入</a>&nbsp;或&nbsp;<a href="register.html">注册</a>&nbsp;ANTA会员<p><span class="iconfont icon-gouwuche" id="cart"></span><span>1</span></p><p><span class="iconfont icon-iconrx"></span></p></div><div class="headMid"></div><div class="headBottom"><div><a href="index.html"><img src="../img/logo.jpg" alt="anta"></a></div><nav><li><a href="javascript:;">男子</a><!-- 二级导航 --><div class="secNav"><ul><p>系列推荐</p><li><img src="../img/nav-i-kt.png" alt=""></li><li><img src="../img/nav-i-cola.png" alt=""></li><li><img src="../img/nav-i-mv.png" alt=""></li><li><img src="../img/nav-i-lzh.png" alt=""></li><li>故宫</li><li>RICO</li><li>老爹鞋</li><li>小白鞋</li></ul><ul><h3>所有鞋类</h3><li>运动鞋</li><li>跑鞋</li><li>篮球鞋</li><li>运动鞋</li><li>跑鞋</li><li>篮球鞋</li><li>运动鞋</li><li>跑鞋</li><li>篮球鞋</li></ul><ul><h3>所有服装</h3><li>运动鞋</li><li>跑鞋</li><li>篮球鞋</li><li>运动鞋</li><li>跑鞋</li><li>篮球鞋</li><li>运动鞋</li><li>跑鞋</li><li>篮球鞋</li><li>运动鞋</li><li>跑鞋</li><li>篮球鞋</li><li>运动鞋</li><li>跑鞋</li><li>篮球鞋</li><li>运动鞋</li><li>跑鞋</li><li>篮球鞋</li></ul><ul><h3>所有配件</h3><li>运动鞋</li><li>跑鞋</li><li>篮球鞋</li><li>运动鞋</li><li>跑鞋</li><li>篮球鞋</li><li>运动鞋</li><li>跑鞋</li><li>篮球鞋</li></ul><ul><h3>运动系列</h3><li>运动鞋</li><li>跑鞋</li><li>篮球鞋</li><li>运动鞋</li><li>跑鞋</li><li>篮球鞋</li><li>运动鞋</li><li>跑鞋</li><li>篮球鞋</li></ul><ul><h3>热销精品</h3><li><img src="../img/nav-man-01.jpg" alt=""></li></ul></div></li><li><a href="javascript:;">女子</a></li><li><a href="javascript:;">儿童</a></li><li><a href="javascript:;">安踏儿童</a></li><li><a href="javascript:;">品牌文化</a></li><li><a href="javascript:;">观赏视频</a></li><li><a href="javascript:;">联系我们</a></li></nav><div><a href="list.html"><span class="iconfont icon-41 search"></span> </a><input type="text" placeholder="搜索"></div></div></header><main><div class="wrap"><!-- 未登录 --><!-- <div class="unlg">
                <p></p>
            </div> --><!-- 登录成功 --><div class="lging"><span></span><h3>我的购物车 <span class="count"></span></h3><p><input type="checkbox" class="checkall">全选</p><ul class="cartlist"><!-- <li data-id="10001">
                    <input type="checkbox" class="ck">
                    <img src="../img/1.jpg">
                    <div class="name">
                        <h5>炙热男鞋潮流户外时尚运动休闲鞋</h5>
                        <p>款号:19999</p>
                        <p> 数量
                            <span class="minus">-</span>
                            <input type="text" value="1" class="pnum">
                            <span class="plus">+</span>
                        </p>
                    </div>
                    <div class="priceBox">
                        <span class="price">￥100</span>
                        <input type="button" value="删除" class="delBtn"></li>
                    </div> --></ul></div></div></main><!-- 总价 --><div class="total-price"><p><input type="checkbox" class="checkall-price">全选商品 <input type="button" value="删除商品" class="delall"></p><p>总价: ￥0.00</p></div><!-- 侧边栏 aside--><aside><a href="#backtop"><span class="aside-icon iconfont icon-zelvxuanzefeiyongzhengsanjiaoxingzhichi"></span> 回到顶部</a><div class="line"></div><a href="javascript:;"><span class="aside-icon iconfont icon-gouwuche"></span> 购物车</a><div class="line"></div><a href="javascript:;"><span class="aside-icon iconfont icon-iconrx"></span> 客服</a></aside><!-- footer 引入footer.html文件 --><iframe src="footer.html" frameborder="0" marginwidth="0" marginheight="0" width="100%" height="265"></iframe><script src="../libs/jquery.min.js"></script><script>$(function () {
            //登录后改名登录 
            var userData = JSON.parse(localStorage.getItem("userData"));
            if (userData) {
                $('.headTop').find('a').eq(0).html("你好!  " + userData.username);
                let uid = userData.uid;
                $.get("http://jx.xuzhixiang.top/ap/api/cart-list.php", {
                    "id": uid
                }).then(data => {
                    var str = '';
                    var obj = data.data;
                    var num = 0;
                    var total = 0;
                    $.each(obj, function (i, n) {
                        str += `<li data-id="${n.pid}">
                                <input type="checkbox" class="ck">
                                <img src="${n.pimg}">
                                <div class="name">
                                    <h5>${n.pdesc}</h5>
                                    <p>款号:${n.pid}</p>
                                    <p> 数量
                                        <span class="minus">-</span>
                                        <input type="text" value="${n.pnum}" class="pnum">
                                        <span class="plus">+</span>
                                    </p>
                                </div>
                                <div class="priceBox">
                                    <span class="price">￥${n.pprice}</span>
                                    <input type="button" value="删除" class="delBtn"></li>
                                </div>
                            </li>`;
                        num += Number(n.pnum);
                        total += Number(n.pnum) * Number(n.pprice);
                    });
                    $('.cartlist').html(str);

                    $('main').css({ "height": $('.cartlist').outerHeight() + 150 })
                    //商品数量增删
                    // 减
                    for (let i = 0; i < $('.minus').length; i++) {
                        $('.minus').eq(i).click(function () {
                            let j = Number($(this).parent().find('.pnum').attr('value'));
                            let id = $(this).parent().parent().parent().attr("data-id");
                            j--;
                            if (j < 1) { j = 1 };
                            $(this).parent().find('.pnum').attr("value", j);
                            upData(uid,id,j);
                        })
                    }
                    //增
                    $('.plus').click(function () {
                        let j = Number($(this).parent().find('.pnum').attr('value'));
                        let id = $(this).parent().parent().parent().attr("data-id");
                        j++;
                        if (j < 1) { j = 1 };
                        $(this).parent().find('.pnum').attr("value", j);
                        upData(uid,id,j);

                    })
                    //改
                    $('.pnum').change(function () {
                        let j = $(this).val();
                        let id = $(this).parent().parent().parent().attr("data-id");
                        $(this).attr("value", j);
                        upData(uid,id,j);

                    })
                    //删
                    $('.delBtn').click(function () {
                        let id = $(this).parent().parent().attr('data-id');
                        $(this).parent().parent().find('.ck').attr("checked", false);
                        $(this).parent().parent().remove();
                        $.get("http://jx.xuzhixiang.top/ap/api/cart-delete.php", {
                            "uid": uid,
                            "pid": id
                        }).then(data => {
                            location.reload();
                        })
                    })
                    //全选
                    $('.ck').click(function () {
                        let count = 0;
                        for (let j = 0; j < $('.ck').length; j++) {

                            if ($('.ck').eq(j)[0].checked) {
                                count++;
                            }
                        }
                        if (count == $('.ck').length) {
                            $('.checkall')[0].checked = true;
                            $('.checkall-price')[0].checked = true;
                        } else {
                            $('.checkall')[0].checked = false;
                            $('.checkall-price')[0].checked = false;

                        }
                        let price = $(this).parent().find('.pnum').val() * $(this).parent().find('.price').text().split("￥")[1];

                        if ($(this)[0].checked) {
                            $('.total-price').find('p:last-child').html("总价:￥" + price);
                        } else {
                            $('.total-price').find('p:last-child').html("总价:￥0.00");
                        }
                    });

                    $('.checkall').click(function () {
                        $('.checkall-price')[0].checked = $('.checkall')[0].checked;
                        for (let j = 0; j < $('.ck').length; j++) {
                            $('.ck').eq(j)[0].checked = $('.checkall')[0].checked;
                        }
                        if ($('.checkall')[0].checked) {
                            //总价
                            $('.total-price').find('p:last-child').html("￥" + total);
                        } else {
                            $('.total-price').find('p:last-child').html("￥0.00");
                        }

                    })
                    $('.checkall-price').click(function () {
                        $('.checkall')[0].checked = $('.checkall-price')[0].checked;
                        for (let j = 0; j < $('.ck').length; j++) {
                            $('.ck').eq(j)[0].checked = $('.checkall-price')[0].checked;
                        }
                        if ($('.checkall-price')[0].checked) {
                            //总价
                            $('.total-price').find('p:last-child').html("￥" + total);
                        } else {
                            $('.total-price').find('p:last-child').html("￥0.00");
                        }

                    })


                    //全删
                    $('.delall').click(function () {
                        console.log('a')
                        for (let i = 0; i < $('.cartlist>li').length; i++) {
                            let id = $('.cartlist>li').eq(i).attr("data-id");
                            $.get("http://jx.xuzhixiang.top/ap/api/cart-delete.php", {
                                "uid": uid,
                                "pid": id
                            }).then(data => {
                                location.reload();
                            })
                        }
                    });
                    $('.count').html("共" + num + "件");
                })

            } else {
                $('.cartlist').html('<li>您的购物车中没有任何商品，马上去--><a href="index.html">挑选商品</a><li>');
                $('.lging>p').css({ "display": "none" })
            }
            //跳转
            $('#cart').click(function () {
                location.href = "cart.html";
            });
            function upData(uid,id,j) {
                $.get("http://jx.xuzhixiang.top/ap/api/cart-update-num.php", {
                    "uid": uid,
                    "pid": id,
                    "pnum": j
                }).then(data => {
                    location.reload();
                });
            }

        });</script></body></html>